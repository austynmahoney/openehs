@model OpenEhs.Domain.Patient
@{
    if (Model.MiddleName != String.Empty) {
        ViewBag.Title = String.Format("OpenEHS - Patient: {2}, {0} {1}", Model.FirstName, Model.MiddleName, Model.LastName);
    } else {
        ViewBag.Title = String.Format("OpenEHS - Patient: {1}, {0}", Model.FirstName, Model.LastName);
    }
}
@section head
{
    <link href="@Url.Content("~/Content/jvert-tabs/jquery-jvert-tabs-1.1.4.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/patient.view.css")" rel="Stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/patient.css")" rel="Stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-jvert-tabs-1.1.4.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/ckedit/ckeditor.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/ckedit/adapters/jquery.js")" type="text/javascript"></script>
    @* Hack for enabling jQuery intellisense.  See http://blogs.msdn.com/b/webdevtools/archive/2008/10/28/rich-intellisense-for-jquery.aspx *@
    @if (false) {
        <script src="../../Scripts/jquery-1.4.4-vsdoc.js" type="text/javascript"></script>
    }
    <script type="text/javascript">
        $(document).ready(function () {
        var allergyEditId;
        var allergyEditName;
            var name = $( "#modal_allergyName" ),
			    allFields = $( [] ).add( name ),
			    tips = $( ".validateTips" );
                
            $("#patientView").jVertTabs();

            $("#DateOfBirth").datepicker({
                showOn: "button",
                buttonImage: "@Url.Content("~/Content/themes/base/images/calendar.png")",
                buttonImageOnly: true,
                changeYear: true
            });

            $("#EmergencyContactMoreInfoLink").click(function() {
                $("#EmergencyContactMoreInfo").slideToggle("slow", function() {
                });
            });

            $("#BasicMoreInfoLink").click(function() {
                $("#BasicMoreInfo").slideToggle("slow", function() {
                });
            });

            $( "#allergyDialog" ).dialog({
			    autoOpen: false,
			    height: 250,
			    width: 350,
			    modal: true,
			    buttons: {
				    "Save Allergy": function() {
                        $.post("Patient/EditAllergy", {
                            patientID: "@Model.Id",
                            allergyID: allergyEditId,
                            allergyName: allergyEditName 
                            }, function(data) {
                                var returnData = jQuery.parseJSON(data);
                                console.log(returnData);
                                $("#allergyPostStatus").html(returnData.status);
                                $( this ).dialog( "close" );
                        });
				    },
				    Cancel: function() {
					    $( this ).dialog( "close" );
				    }
			    },
			    close: function() {
				    allFields.removeClass( "ui-state-error" );
			    }
		    });

             $("#newVitalDialog").dialog({
			    autoOpen: false,
			    height: 400,
			    width: 400,
			    modal: true,
			    buttons: {
				    "Save Vital": function() 
                    {
                        $.post("/Patient/AddVital", 
                        {
                            patientID: "@Model.Id",
                            height: document.getElementById("modal_vitalHeight").value,
                            weight: document.getElementById("modal_vitalWeight").value,
                            temperature: document.getElementById("modal_vitalTemperature").value,
                            heartRate: document.getElementById("modal_vitalHeartRate").value,
                            BpSystolic: document.getElementById("modal_vitalBpSystolic").value,
                            BpDiastolic: document.getElementById("modal_vitalBpDiastolic").value,
                            respiratoryRate: document.getElementById("modal_vitalRespiratoryRate").value
                        });
                        $( this ).dialog("close");

				    },
				    Cancel: function() {
					    $( this ).dialog( "close" );
				    }
			    },
			    close: function() {
				    allFields.removeClass("ui-state-error");
			    }
		    });

            $(".allergyEditButton").button().click(function() {
                allergyEditId = $(this).attr("id");
                allergyEditName = $(this).attr("name");
                $("#modal_allergyName").val(allergyEditName);
                $("#allergyDialog").dialog("open");
            });  

            $(".vitalAddButton").button().click(function() {
                $("#newVitalDialog").dialog("open");
            });  


            $( "#diseaseDialog" ).dialog({
			    autoOpen: false,
			    height: 300,
			    width: 350,
			    modal: true,
			    buttons: {
				    "Save Disease": function() {
					    var bValid = true;
					    allFields.removeClass( "ui-state-error" );

					    if ( bValid ) {
						    $( this ).dialog( "close" );
					    }
				    },
				    Cancel: function() {
					    $( this ).dialog( "close" );
				    }
			    },
			    close: function() {
				    allFields.removeClass( "ui-state-error" );
			    }
		    });

            $(".diseaseEditButton").button().click(function() {
                $("#diseaseDialog").dialog("open");
            });    
			
			$(".allergyAddButton").button().click(function() 
			{
                
            });  

            var ckConfig = {
                toolbar:
                [
                    ["Bold", "Italic", "-", "NumberedList", "BulletedList", "-"],
                    ["UIColor"]
                ],
                extraPlugins: "autogrow",
                autoGrow_maxHeight: 800
            };

            $("#patientNoteTextBox").ckeditor(ckConfig);

			$(".chronicDiseasesAddButton").button().click(function() 
			{
                
            });             
        });
    </script>
}
<div id="patientViewHeader" class="group">
    @if (Model.MiddleName != String.Empty) {
        <h2>@String.Format("{2}, {0} {1}", Model.FirstName, Model.MiddleName, Model.LastName)</h2>
    } else {
        <h2>@String.Format("{1}, {0}", Model.FirstName, Model.LastName)</h2>
    }
    <h2 style="margin-left: 20px; font-weight: normal;">
        Age: @Model.Age</h2>
    <h2 style="margin-left: 20px; font-weight: normal;">
        DOB: @String.Format("{0:d}", Model.DateOfBirth)</h2>
    <div style="float: right; margin-right: 20px; margin-top: 13px;">
        @Html.CheckBoxFor(model => model.IsActive) @Html.LabelFor(model => model.IsActive, "Active")
    </div>
</div>
<div id="patientView">
    <div>
        <ul>
            <li><a href="#patientView-Basic">Basic</a></li>
            <li><a href="#patientView-Vitals">Vitals</a></li>
            <li><a href="#patientView-PMH">PMH</a></li>
            <li><a href="#patientView-DxHistory">Dx History</a></li>
            <li><a href="#patientView-RxList">Rx List</a></li>
            <li><a href="#patientView-ChronicDiseases">Chronic Diseases</a></li>
            <li><a href="#patientView-Allergies">Allergies</a></li>
            <li><a href="#patientView-Encounters">Encounters</a></li>
        </ul>
    </div>
    <div>
        <div id="#patientView-Basic" class="group">
            @Html.Partial("_tab-Basic", Model)
        </div>
        <div id="#patientView-Vitals">
            @Html.Partial("_tab-Vitals",Model)
        </div>
        <div id="#patientView-PMH">
            @Html.Partial("_tab-PMH", Model)
        </div>
        <div id="#patientView-DxHistory">
            @Html.Partial("_tab-DxHistory", Model)
        </div>
        <div id="#patientView-RxList">
            @Html.Partial("_tab-RxList", Model)
        </div>
        <div id="#patientView-ChronicDiseases">
            @Html.Partial("_tab-ChronicDiseases", Model)
        </div>
        <div id="#patientView-Allergy">
            @Html.Partial("_tab-Allergy", Model)
        </div>
        <div id="#patientView-Encounters">
            @Html.Partial("_tab-Encounters", Model)
        </div>
    </div>
    <p>
        @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
        @Html.ActionLink("Back to List", "Index")
    </p>
</div>
