@model OpenEhs.Domain.Patient

@{
    if (Model.MiddleName != String.Empty)
    {
        ViewBag.Title = String.Format("Patient: {2}, {0} {1}", Model.FirstName, Model.MiddleName, Model.LastName);
    }
    else
    {
        ViewBag.Title = String.Format("Patient: {1}, {0}", Model.FirstName, Model.LastName);
    }
}

@section head
{
    <link href="@Url.Content("~/Content/jvert-tabs/jquery-jvert-tabs-1.1.4.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/patient.view.css")" rel="Stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-jvert-tabs-1.1.4.js")" type="text/javascript"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#patientView").jVertTabs();
            $("#GenderRadio").buttonset();

            $("#DateOfBirth").datepicker({
                showOn: "button",
                buttonImage: "@Url.Content("~/Content/themes/base/images/calendar.png")",
                buttonImageOnly: true,
                changeYear: true
            });

            $("#EmergencyContactMoreInfoLink").click(function() {
                $("#EmergencyContactMoreInfo").slideToggle("slow", function() {
                });
            });
        });
    </script>

}

<div id="patientViewHeader" class="group">
    @if (Model.MiddleName != String.Empty)
    {
        <h2>@String.Format("{2}, {0} {1}", Model.FirstName, Model.MiddleName, Model.LastName)</h2>
    }
    else
    {
        <h2>@String.Format("{1}, {0}", Model.FirstName, Model.LastName)</h2>
    }

    <h2 style="margin-left: 20px; font-weight: normal;">@Model.Age</h2>
    <h2 style="margin-left: 20px; font-weight: normal;">DOB: @String.Format("{0:d}", Model.DateOfBirth)</h2>
    <div style="float: right; margin-right: 20px; margin-top: 13px;">
        @Html.CheckBoxFor(model => model.IsActive) @Html.LabelFor(model => model.IsActive, "Active")
    </div>
</div>
<div id="patientView">
    <div>
        <ul>
            <li><a href="#patientView-Basic">Basic</a></li>
            <li><a href="#patientView-ChronicDiseases">Chronic Diseases</a></li>
            <li><a href="#patientView-Allergies">Allergies</a></li>
            <li><a href="#patientView-Encounters">Encounters</a></li>
            <li><a href="#patientView-Testing">Testing</a></li>
        </ul>
    </div>
    <div>
        <div id="#patientView-Basic" class="group">
            <div id="BasicInformationColumn">
                <fieldset class="group">
                    <legend>General</legend>
                    <div class="column">
                        @Html.LabelFor(model => model.Id, "Patient ID")<br />
                        @Html.TextBoxFor(model => model.Id)<br />
                        @Html.LabelFor(model => model.FirstName, "First Name")<br />
                        @Html.TextBoxFor(model => model.FirstName)<br />
                        @Html.LabelFor(model => model.MiddleName, "Middle Name")<br />
                        @Html.TextBoxFor(model => model.MiddleName)<br />
                        @Html.LabelFor(model => model.LastName, "Last Name")<br />
                        @Html.TextBoxFor(model => model.LastName)<br />
                    </div>
                    <div class="column">
                        @Html.LabelFor(model => model.Gender, "Gender")<br />
                        <div id="GenderRadio">
                            @Html.RadioButtonFor(model => model.Gender, "Male", new { @id = "MaleGenderRadio" }) @Html.Label("MaleGenderRadio", "Male")
                            @Html.RadioButtonFor(model => model.Gender, "Female", new { @id = "FemaleGenderRadio" }) @Html.Label("FemaleGenderRadio", "Female")
                        </div>
                        @Html.LabelFor(model => model.DateOfBirth, "DOB")<br />
                        @Html.TextBox("DateOfBirth", String.Format("{0:d}", Model.DateOfBirth))<br />
                        @Html.LabelFor(model => model.PhoneNumber, "Phone Number")<br />
                        @Html.TextBoxFor(model => model.PhoneNumber)
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Emergency Contact</legend>
                    @Html.LabelFor(model => model.EmergencyContact.FirstName)<br />
                    @Html.TextBoxFor(model => model.EmergencyContact.FirstName)<br />
                    @Html.LabelFor(model => model.EmergencyContact.LastName)<br />
                    @Html.TextBoxFor(model => model.EmergencyContact.LastName)<br />
                    @Html.LabelFor(model => model.EmergencyContact.PhoneNumber)<br />
                    @Html.TextBoxFor(model => model.EmergencyContact.PhoneNumber)<br /><br />
                    <div id="EmergencyContactMoreInfoLink">Show Details...</div>
                    <div id="EmergencyContactMoreInfo">
                        @Html.LabelFor(model => model.EmergencyContact.Address.Street1)<br />
                        @Html.TextBoxFor(model => model.EmergencyContact.Address.Street1)<br />
                        @Html.LabelFor(model => model.EmergencyContact.Address.Street2)<br />
                        @Html.TextBoxFor(model => model.EmergencyContact.Address.Street2)<br />
                        @Html.LabelFor(model => model.EmergencyContact.Address.City)<br />
                        @Html.TextBoxFor(model => model.EmergencyContact.Address.City)<br />
                        @Html.LabelFor(model => model.EmergencyContact.Address.Region)<br />
                        @Html.TextBoxFor(model => model.EmergencyContact.Address.Region)
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Address</legend>
                    @Html.LabelFor(model => model.Address.Street1, "Street 1")<br />
                    @Html.TextBoxFor(model => model.Address.Street1)<br />
                    @Html.LabelFor(model => model.Address.Street2, "Street 2")<br />
                    @Html.TextBoxFor(model => model.Address.Street2)<br />
                    @Html.LabelFor(model => model.Address.City)<br />
                    @Html.TextBoxFor(model => model.Address.City)<br />
                    @Html.LabelFor(model => model.Address.Region)<br />
                    @Html.TextBoxFor(model => model.Address.Region)
                </fieldset>
            </div>
            <div id="BasicInformationNotes">
                <fieldset>
                    <legend>Notes</legend>
                    <textarea cols="25" rows="20">Notes go here!</textarea>
                </fieldset>
            </div>
        </div>
        <div id="#patientView-ChronicDiseases">
            <ul>
				@foreach(var problems in Model.Problems)
				{
					<li>@problems.ProblemName</li>
				}
            </ul>
        </div>
        <div id="#patientView-Allergies">
            <ul>
            @foreach (var allergy in Model.Allergies)
            {
                <li>@allergy.Name</li>
            }
            </ul>

        </div>
        <div id="#patientView-Encounters">
            <h3>Encounters go here.</h3>
        </div>

        <div id="#patientView-Testing">
            <fieldset>
                <legend>CheckIn Test</legend>
                <ul>
                @foreach (var checkin in Model.PatientCheckIns)
                {
                    <li>@String.Format("Checked In: {0:dd/MMM/yyyy H:mm:ss zzz}", checkin.CheckInTime)</li>
                    
                    if (checkin.Invoice != null)
                    {
                        <ul>
                            <li>@String.Format("Invoice #{0} - {2} Items - {1:c}", checkin.Invoice.Id, checkin.Invoice.Total, checkin.Invoice.Items.Count)</li>
                            @if (checkin.Invoice.Items.Count > 0)
                            {
                                <ul>
                                    @foreach(var i in checkin.Invoice.Items)
                                    {
                                        if (i.Product != null)
                                        {
                                            <li>@String.Format("{0} x {1} = {2:c}", i.Product.Name, i.Quantity, i.Total)</li>
                                        }
                                        else if (i.Service != null)
                                        {
                                            <li>@String.Format("{0} x {1} = {2:c}", i.Service.Name, i.Quantity, i.Total)</li>
                                        }
                                    }
                                </ul>
                            }
                        </ul>
                    }
                }
                </ul>
            </fieldset>
        </div>

    </div>
</div>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
</p>